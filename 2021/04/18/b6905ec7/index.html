

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Android Developer">
  <meta name="author" content="sukaidev">
  <meta name="keywords" content="Android sukaidev 苏海鸿">
  <title>深入理解JVM（五）——字节码基础 - Sukai&#39;s Blog - Android Developer</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/atom-one-light.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"sukaidev.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":60,"cursorChar":"_","loop":false},"anchorjs":{"enable":false,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Sukai's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="深入理解JVM（五）——字节码基础">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-18 22:08" pubdate>
        2021年4月18日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      53
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">深入理解JVM（五）——字节码基础</h1>
            
            <div class="markdown-body">
              <p>上篇文章中了解了虚拟机执行子系统中的栈和栈帧结构，并且学习了一些方法调用相关的字节码指令，对于方法的分派过程有了更深入的理解，接下来这篇文章来了解一下基础的字节码指令。</p>
<h2 id="字节码指令"><a href="#字节码指令" class="headerlink" title="字节码指令"></a>字节码指令</h2><p>字节码指令主要有<strong>加载和存储指令</strong>、<strong>操作数栈指令</strong>、<strong>运算和类型转换指令</strong>、<strong>控制转移指令</strong>等，这一部分是了解字节码的基础。</p>
<h3 id="加载和存储指令"><a href="#加载和存储指令" class="headerlink" title="加载和存储指令"></a>加载和存储指令</h3><p><strong>加载（load）</strong>和<strong>存储（store）</strong>相关的指令是使用得最频繁的指令，分为load类、store类、常量加载这三种。</p>
<ul>
<li>load类指令：将局部变量表中的变量加载到操作数栈，比如iload_0将局部变量表中下表为0的int型变量加载到操作数栈上，类似的还有lload、fload、dload、aload，分别表示加载局部变量表中long、float、double、引用类型的变量。</li>
<li>store类指令：将操作数栈栈顶的数据存储到局部变量表中，比如istore_0将操作数栈顶的元素存储到局部变量表中下表为0的位置，类似的还有lstore、fstore、dstore、astore这些指令。</li>
<li>常量加载相关的指令，常见的有const类、push类、ldc类。const、push类指令是将常数值直接加载到操作数栈顶，ldc指令是从常量池加载对应的常量到操作数栈顶。</li>
</ul>
<p>存储指令列表如下所示。</p>
<table>
<thead>
<tr>
<th align="center">指  令  名</th>
<th align="center">描  述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">aconst_null</td>
<td align="center">将null入栈到栈顶</td>
</tr>
<tr>
<td align="center">iconst_m1</td>
<td align="center">将int类型值-1压栈到栈顶</td>
</tr>
<tr>
<td align="center">iconst_&lt;n&gt;</td>
<td align="center">将int类型值n（0~5）压栈到栈顶</td>
</tr>
<tr>
<td align="center">lconst_&lt;n&gt;</td>
<td align="center">将long类型值n（0~1）压栈到栈顶</td>
</tr>
<tr>
<td align="center">fconst_&lt;n&gt;</td>
<td align="center">将float类型值n（0~2）压栈到栈顶</td>
</tr>
<tr>
<td align="center">dconst&lt;n&gt;</td>
<td align="center">将double类型值n（0~1）压栈到栈顶</td>
</tr>
<tr>
<td align="center">bipush</td>
<td align="center">将范围在-128~127的整型值压栈到栈顶</td>
</tr>
<tr>
<td align="center">sipush</td>
<td align="center">将范围在-32768~32767的整型值压栈到栈顶</td>
</tr>
<tr>
<td align="center">ldc</td>
<td align="center">将int、float、String类型的常量值从常量池压栈到栈顶</td>
</tr>
<tr>
<td align="center">ldc_w</td>
<td align="center">作用同ldc，不同的是ldc的操作码是一个字节，ldc_w的操作码是两个字节，即ldc只能寻址255个常量池的索引值，而ldc_w可以覆盖常量池所有的值</td>
</tr>
<tr>
<td align="center">ldc2_w</td>
<td align="center">将long或double类型的常量值从常量池压栈到栈顶</td>
</tr>
<tr>
<td align="center">&lt;T&gt;load</td>
<td align="center">将局部变量表中指定位置的int、long、float、double、引用类型、boolean、byte、char、short类型变量加载到栈上</td>
</tr>
<tr>
<td align="center">&lt;T&gt;load_&lt;n&gt;</td>
<td align="center">将局部变量表中下标为n（0~3）的变量加载到栈上，T可以为i、l、f、d、a</td>
</tr>
<tr>
<td align="center">&lt;T&gt;aload</td>
<td align="center">将指定数组中特定位置的数据加载到栈上，T可以为i、l、f、d、a、b、c、s</td>
</tr>
<tr>
<td align="center">&lt;T&gt;store</td>
<td align="center">将栈顶数据存储到局部变量表中的特定位置，T可以为i、l、f、d、a</td>
</tr>
<tr>
<td align="center">&lt;T&gt;store_&lt;n&gt;</td>
<td align="center">将栈顶变量数据存储到局部变量表中下标为n（0~3）的位置，T可以为i、l、f、d、a</td>
</tr>
<tr>
<td align="center">&lt;T&gt;astore</td>
<td align="center">将栈顶数据存储到数组的指定位置，T可以为i、l、f、d、a、b、c、s</td>
</tr>
</tbody></table>
<h3 id="操作数栈指令"><a href="#操作数栈指令" class="headerlink" title="操作数栈指令"></a>操作数栈指令</h3><p>常见的操作数栈指令有pop、dup和swap。pop指令用于将栈顶的值出栈，dup指令用来复制栈顶的元素并压入栈顶，swap用于交换栈顶的两个元素，如下图所示。</p>
<p><img src="/img/jvm/dup_pop_swap.png" srcset="/img/loading.gif" alt="dup、pop、swap指令"></p>
<p>另外还有几个复杂一点的指令，如下操作数栈指令列表所示。</p>
<table>
<thead>
<tr>
<th align="center">指 令 名</th>
<th align="center">字 节 码</th>
<th align="center">描 述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">pop</td>
<td align="center">0x57</td>
<td align="center">将栈顶数据（非long和double）出栈</td>
</tr>
<tr>
<td align="center">pop2</td>
<td align="center">0x58</td>
<td align="center">弹出栈顶一个long或double类型的数据或者两个其他类型的数据</td>
</tr>
<tr>
<td align="center">dup</td>
<td align="center">0x59</td>
<td align="center">复制栈顶数据并将复制的数据入栈</td>
</tr>
<tr>
<td align="center">dup_x1</td>
<td align="center">0x5A</td>
<td align="center">复制栈顶数据并将复制的数据插入到栈顶第二个元素之下</td>
</tr>
<tr>
<td align="center">dup_x2</td>
<td align="center">0x5B</td>
<td align="center">复制栈顶数据并将复制的数据插入到栈顶第三个元素之下</td>
</tr>
<tr>
<td align="center">dup2</td>
<td align="center">0x5C</td>
<td align="center">复制栈顶两个数据并将复制的数据入栈</td>
</tr>
<tr>
<td align="center">dup2_x1</td>
<td align="center">0x5D</td>
<td align="center">复制栈顶两个数据并将复制的数据插入到栈第二个元素之下</td>
</tr>
<tr>
<td align="center">dup2_x2</td>
<td align="center">0x5E</td>
<td align="center">复制栈顶两个数据并将复制的数据插入到栈第三个元素之下</td>
</tr>
<tr>
<td align="center">swap</td>
<td align="center">0x5F</td>
<td align="center">交换栈顶两个元素</td>
</tr>
</tbody></table>
<h3 id="运算和类型转换指令"><a href="#运算和类型转换指令" class="headerlink" title="运算和类型转换指令"></a>运算和类型转换指令</h3><p>针对Java中的加减乘除相关语法，字节码也有对应的运算指令，如下表示所示。</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">int</th>
<th align="center">long</th>
<th align="center">float</th>
<th align="center">double</th>
</tr>
</thead>
<tbody><tr>
<td align="center">+</td>
<td align="center">iadd</td>
<td align="center">ladd</td>
<td align="center">fadd</td>
<td align="center">dadd</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center">isub</td>
<td align="center">lsub</td>
<td align="center">fsub</td>
<td align="center">dsub</td>
</tr>
<tr>
<td align="center">/</td>
<td align="center">idiv</td>
<td align="center">ldiv</td>
<td align="center">fdiv</td>
<td align="center">ddiv</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">imul</td>
<td align="center">lmul</td>
<td align="center">fmul</td>
<td align="center">dmul</td>
</tr>
<tr>
<td align="center">%</td>
<td align="center">irem</td>
<td align="center">lrem</td>
<td align="center">frem</td>
<td align="center">drem</td>
</tr>
<tr>
<td align="center">negate(-)</td>
<td align="center">ineg</td>
<td align="center">lneg</td>
<td align="center">fneg</td>
<td align="center">dneg</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center">iand</td>
<td align="center">land</td>
<td align="center">–</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">ior</td>
<td align="center">lor</td>
<td align="center">–</td>
<td align="center">–</td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">ixor</td>
<td align="center">lxor</td>
<td align="center">–</td>
<td align="center">–</td>
</tr>
</tbody></table>
<p>这里需要注意的是，如果需要进行运算的数据类型不一样，会涉及到类型转换（cast），例如1.0 + 1 对应的字节码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">fconst_1 <span class="hljs-comment">// 将1.0入栈</span><br>iconst_1 <span class="hljs-comment">// 将1入栈</span><br>fadd  <span class="hljs-comment">// 栈顶两个元素相加</span><br></code></pre></td></tr></table></figure>
<p>这里fadd指令只支持对两个float类型的数据做相加操作，为了支持这种运算，JVM会先把int类型的数据转为float类型然后再相加，这种类型转换称为<strong>宽化类型转换（widening）</strong>。</p>
<h3 id="控制转移指令"><a href="#控制转移指令" class="headerlink" title="控制转移指令"></a>控制转移指令</h3><p>控制转移指令用于有条件和无条件的分支跳转，常见的if-then-else、三目表达式、for循环、异常处理等都属于这个范畴。对应的指令集包括：</p>
<ul>
<li>条件转移：ifeq、iflt、ifle、ifne、ifgt、ifge、ifnull、ifnonnull、if_icmpeq、if_icmpne、if_icmplt、if_icmpgt、if_icmple、if_icmpge、if_acmpeq和if_acmpne。</li>
<li>复合条件转移：tableswitch、lookupswitch。</li>
<li>无条件转移：goto、goto_w、jsr、jsr_w、ret。</li>
</ul>
<p>以下面代码为例来分析字节码，它的作用是判断一个整数是否为整数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">isPositive</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span></span>&#123;<br>  <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>对应的字节码如下所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">0</span>: iload_1  <span class="hljs-comment">// 将局部变量表中下标为1的int变量加载到操作数栈上</span><br><span class="hljs-number">1</span>: ifle <span class="hljs-number">6</span>   <span class="hljs-comment">// 将操作数栈顶元素出栈与0比较，如果小于等于0则跳转到字节码第六行</span><br><span class="hljs-number">4</span>: iconst_1 <span class="hljs-comment">// 4~5行对应代码”return 1“，这里先将常量1压到栈顶</span><br><span class="hljs-number">5</span>: ireturn  <span class="hljs-comment">// 将栈顶整数1出栈并返回</span><br><span class="hljs-number">6</span>: iconst_0  <span class="hljs-comment">// 将常量0压入栈顶</span><br><span class="hljs-number">7</span>: ireturn  <span class="hljs-comment">// 将栈顶整数0出栈返回</span><br></code></pre></td></tr></table></figure>
<p>假设n等于20，调用isPositive(20)方法操作数栈的变化情况如下图所示。</p>
<p><img src="/img/jvm/jvm_bytecode_ispositive.png" srcset="/img/loading.gif" alt="isPositive(/img/jvm/jvm_bytecode_ispositive.png)操作数栈变化">所所有控制转移指令如下表所示。</p>
<table>
<thead>
<tr>
<th align="center">指 令 名</th>
<th align="center">字 节 码</th>
<th align="center">描 述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ifeq</td>
<td align="center">0x99</td>
<td align="center">如果栈顶int型变量等于0，则跳转</td>
</tr>
<tr>
<td align="center">ifne</td>
<td align="center">0x9A</td>
<td align="center">如果栈顶int型变量不等于0，则跳转</td>
</tr>
<tr>
<td align="center">iflt</td>
<td align="center">0x9B</td>
<td align="center">如果栈顶int型变量小于0，则跳转</td>
</tr>
<tr>
<td align="center">ifge</td>
<td align="center">0x9C</td>
<td align="center">如果栈顶int型变量大于等于0，则跳转</td>
</tr>
<tr>
<td align="center">ifgt</td>
<td align="center">0x9D</td>
<td align="center">如果栈顶int型变量大于0，则跳转</td>
</tr>
<tr>
<td align="center">ifle</td>
<td align="center">0x9E</td>
<td align="center">如果栈顶int型变量小于等于0，则跳转</td>
</tr>
<tr>
<td align="center">if_icmpeq</td>
<td align="center">0x9F</td>
<td align="center">比较栈顶两个int型变量，如果相等则跳转</td>
</tr>
<tr>
<td align="center">if_icmpne</td>
<td align="center">0xA0</td>
<td align="center">比较栈顶两个int型变量，如果不相等则跳转</td>
</tr>
<tr>
<td align="center">if_icmplt</td>
<td align="center">0xA1</td>
<td align="center">比较栈顶两个int型变量，如果小于则跳转</td>
</tr>
<tr>
<td align="center">if_icmpge</td>
<td align="center">0xA2</td>
<td align="center">比较栈顶两个int型变量，如果大于等于则跳转</td>
</tr>
<tr>
<td align="center">if_icmpgt</td>
<td align="center">0xA3</td>
<td align="center">比较栈顶两个int型变量，如果大于则跳转</td>
</tr>
<tr>
<td align="center">if_icmple</td>
<td align="center">0xA4</td>
<td align="center">比较栈顶两个int型变量，如果小于等于则跳转</td>
</tr>
<tr>
<td align="center">if_acmpeq</td>
<td align="center">0xA5</td>
<td align="center">比较栈顶两个引用类型变量，如果相等则跳转</td>
</tr>
<tr>
<td align="center">if_acmpne</td>
<td align="center">0xA6</td>
<td align="center">比较栈顶两个引用类型变量，如果不相等则跳转</td>
</tr>
<tr>
<td align="center">goto</td>
<td align="center">0xA7</td>
<td align="center">无条件跳转</td>
</tr>
<tr>
<td align="center">tableswitch</td>
<td align="center">0xAA</td>
<td align="center">switch条件跳转，case值紧凑的情况下使用</td>
</tr>
<tr>
<td align="center">lookupswitch</td>
<td align="center">0xAB</td>
<td align="center">switch条件跳转，case值稀疏的情况下使用</td>
</tr>
</tbody></table>
<h3 id="for语句的字节码原理"><a href="#for语句的字节码原理" class="headerlink" title="for语句的字节码原理"></a>for语句的字节码原理</h3><p>下面通过分析一段for循环代码来理解上述字节码指令。</p>
<p>纵观所有的字节码指令，并没有与for名字相关的指令，那么for循环的实现原理是怎样的呢？</p>
<p>以下列为例，看看JVM是如何处理高级for循环的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] numbers)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> num : numbers) &#123;<br>        sum += num;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>同样的，使用 javac -p 命令编译后，通过javap -c -v -l 来查看字节码：</p>
<p><img src="/img/jvm/jvm_bytecode_sum.png" srcset="/img/loading.gif" alt="sum方法字节码"></p>
<p>为了方便理解，我们可以把局部变量表画出来，如下图所示。</p>
<p><img src="/img/jvm/jvm_bytecode_sum_op.png" srcset="/img/loading.gif" alt="sum方法局部变量表"></p>
<p>下面以执行sum(new int[]{0,20,30});为例来逐行分析字节码执行过程。</p>
<p>第0~1行：把常量0加载到操作数栈上，随后通过istore_2指令将0出栈赋值给局部变量表中下标为2的元素，就是将sum赋值为0。此时的局部变量表和操作数栈如下图所示。</p>
<p><img src="/img/jvm/image-20210410104512311.png" srcset="/img/loading.gif" alt="for循环执行细节（1）"></p>
<p>第2~9行：初始化循环控制变量，可以使用如下伪代码表示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">$array = numbers;<br>$len = $array.arraylength<br>$i = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<p>第2~3行：aload_1指令的作用是加载局部变量表中下标为1的变量（参数numbers），astore_3指令的作用是将栈顶元素存储到局部变量表下标为3的位置上，这里记为$array，如下图所示。</p>
<p><img src="/img/jvm/image-20210410111449022.png" srcset="/img/loading.gif" alt="for循环执行细节（2）"></p>
<p>第4~6行：计算数据的长度，astore_3加载$array到栈顶，调用arrayLength指令获取数组长度存储到栈顶，随后调用istore 4将数组长度存储到局部变量表的第4个位置，这里记为$len，如下图所示。</p>
<p><img src="/img/jvm/image-20210410123456070.png" srcset="/img/loading.gif" alt="for循环执行细节（3）"></p>
<p>第8~9行：初始化数组遍历的下标初始值。iconst_0将0加载到操作数栈上，随后istore 5将栈顶的0存储到局部变量表中的第5个位置，这个局部变量是数据变量的下表初始值，这里记为$i，如下图所示。</p>
<p><img src="/img/jvm/image-20210410123800666.png" srcset="/img/loading.gif" alt="for循环执行细节（4）"></p>
<p>第11~32行是循环体执行过程。</p>
<p>第11~15行的作用是判断循环能否继续：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">11</span>: iload         <span class="hljs-number">5</span><br><span class="hljs-number">13</span>: iload         <span class="hljs-number">4</span><br><span class="hljs-number">15</span>: if_icmpge     <span class="hljs-number">35</span><br></code></pre></td></tr></table></figure>
<p>首先通过iload 5和iload 4加载局部变量表中下标5和4的变量到栈顶，参照上图中的局部变量表我们知道下标5和下标4的变量分别是数组下标$i和数组长度$len。</p>
<p>接着会调用if_icmpge进行条件判断，如果$i &gt;= $len，则直接跳转到第35行指令处，for循环结束，否则继续往下执行。过程如下图所示。</p>
<p><img src="/img/jvm/image-20210410141322131.png" srcset="/img/loading.gif" alt="for循环执行细节（5）"></p>
<p>第18~22行的作用是把$array[$i]赋值给number。aload_3加载$array到栈上，iload 5加载$i到栈上，然后iaload指令把下标为$i的数组元素加载到操作数栈上，随后istore 6将栈顶元素存储到局部变量表下标为6的位置上，如下图所示。</p>
<p><img src="/img/jvm/image-20210410145943441.png" srcset="/img/loading.gif" alt="for循环执行细节（6）"></p>
<p>第24~28行：iload_2 和 iload 6指令把sum和number值加载到操作数栈上，然后执行iadd指令进行整数相加，如下图所示。</p>
<p><img src="/img/jvm/image-20210410164045262.png" srcset="/img/loading.gif" alt="for循环执行细节（7）"></p>
<p>第29行：”iinc 5,1“指令对执行循环后的$i加一。iinc指令比较特殊，它并不依赖于操作数栈，而是直接对局部变量进行自增，再将结果出栈存储到局部变量表，因此效率非常高。</p>
<p><img src="/img/jvm/image-20210410164642263.png" srcset="/img/loading.gif" alt="for循环执行细节（8）"></p>
<p>第32行：goto 11指令无条件跳转到第11行继续进行循环条件判断。</p>
<p>经过上述分析，很容易发现所谓”高级”for循环翻译成字节码后实际上与普通的for循环并无差别，只是个语法糖而已。</p>
<h3 id="swtich-case底层实现原理"><a href="#swtich-case底层实现原理" class="headerlink" title="swtich-case底层实现原理"></a>swtich-case底层实现原理</h3><p>switch-case语法实现原理依赖于tableswitch和lookupswtich两条字节码指令。先来看下面的与其字节码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">chooseNear</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;<br>    <span class="hljs-keyword">switch</span> (i) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">101</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">104</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 对应字节码</span><br><span class="hljs-number">0</span>: iload_1<br><span class="hljs-number">1</span>: tableswitch   &#123; <span class="hljs-comment">// 100 to 104</span><br>             <span class="hljs-number">100</span>: <span class="hljs-number">36</span><br>             <span class="hljs-number">101</span>: <span class="hljs-number">38</span><br>             <span class="hljs-number">102</span>: <span class="hljs-number">42</span><br>             <span class="hljs-number">103</span>: <span class="hljs-number">42</span><br>             <span class="hljs-number">104</span>: <span class="hljs-number">40</span><br>         <span class="hljs-keyword">default</span>: <span class="hljs-number">42</span><br>    &#125;<br><span class="hljs-number">36</span>: iconst_0<br><span class="hljs-number">37</span>: ireturn<br><span class="hljs-number">38</span>: iconst_1<br><span class="hljs-number">39</span>: ireturn<br><span class="hljs-number">40</span>: iconst_4<br><span class="hljs-number">41</span>: ireturn<br><span class="hljs-number">42</span>: iconst_m1<br><span class="hljs-number">43</span>: ireturn<br></code></pre></td></tr></table></figure>
<p>这里使用了tableswitch指令，之前说过tableswitch指令在case比较紧凑的情况下使用。这里需要特别注意的是，代码中并没有102和103两个case，字节码中却自动帮我们“补齐”了，实际上是编译器对“紧凑”case的优化：一是使用tableswitch；二是case出现断层时自动补齐为连续的值。这样的好处是由于case是连续的所以可以以O(1)的时间复杂度来进行查找。</p>
<p>再看一个case比较“稀疏”的情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">chooseFar</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;<br>    <span class="hljs-keyword">switch</span> (i) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 对应字节码</span><br><span class="hljs-number">0</span>: iload_1<br><span class="hljs-number">1</span>: lookupswitch  &#123; <span class="hljs-comment">// 3</span><br>               <span class="hljs-number">1</span>: <span class="hljs-number">36</span><br>              <span class="hljs-number">10</span>: <span class="hljs-number">38</span><br>             <span class="hljs-number">100</span>: <span class="hljs-number">41</span><br>         <span class="hljs-keyword">default</span>: <span class="hljs-number">44</span><br>    &#125;<br><span class="hljs-number">36</span>: iconst_1<br><span class="hljs-number">37</span>: ireturn<br><span class="hljs-number">38</span>: bipush        <span class="hljs-number">10</span><br><span class="hljs-number">40</span>: ireturn<br><span class="hljs-number">41</span>: bipush        <span class="hljs-number">100</span><br><span class="hljs-number">43</span>: ireturn<br><span class="hljs-number">44</span>: iconst_m1<br><span class="hljs-number">45</span>: ireturn<br></code></pre></td></tr></table></figure>
<p>可以看到这种情况case将不会被补齐，而且没有使用tableswitch而是lookupswitch字节码指令，并且case会经过排序，使得lookupswitch可以以二分查找的方式进行case的查找，时间复杂度为O(log n)。</p>
<h3 id="String的switch-case实现的字节码原理"><a href="#String的switch-case实现的字节码原理" class="headerlink" title="String的switch-case实现的字节码原理"></a>String的switch-case实现的字节码原理</h3><p>上面讨论的两种情况都是基于case是整形数值的情况，Java中支持在Swtich中使用String，那么这是如何实现的呢？</p>
<p>同样以一段代码为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">stringSwitch</span><span class="hljs-params">(String name)</span> </span>&#123;<br>    <span class="hljs-keyword">switch</span> (name) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Java&quot;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Kotlin&quot;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">200</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>对应字节码如下图：</p>
<p><img src="/img/jvm/image-20210410173623801.png" srcset="/img/loading.gif" alt="对String进行switch对应字节码"></p>
<p>这里有几个比较关键的点，第5行中调用了String#hashCode()方法，并且选择使用lookupswitch指令，判断case后跳转到对应的行数。</p>
<p>由于hash值相同的String也有可能是不同字符串，因此随后会调用String#equals()方法来判断是否是相等。这里使用了ifeq指令，ifeq用于判断栈顶数据是否等于0，是则跳转到对应的行数，相当于等于false时跳转。如果相等将会继续执行，使用iconst_0将常量0压入栈顶，表示匹配了case0，或者使用iconst_1将常量1压入栈顶，表示匹配了case1，随后使用istore_3存入局部变量表。</p>
<p>接着就是第61~96行的处理了。61行拿到刚刚存入的0或者1，通过lookupswitch来判断跳转到不同的字节码行数执行case里面的操作。</p>
<h3 id="i和i-的字节码源码"><a href="#i和i-的字节码源码" class="headerlink" title="++i和i++的字节码源码"></a>++i和i++的字节码源码</h3><p>在日常开发中我们通常不会使用++i和i++这两种容易让人困惑的自增方式，而使用更加清晰的i = i + 1，不过它们很容易在面试中作为陷阱题出现，例如下列代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">inc</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">50</span>; j++) &#123;<br>        i = i++;<br>    &#125;<br>    System.out.println(i);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这段代码的输出结果是什么呢？答案是0，查看 i = i++ 的字节码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">···<br><span class="hljs-number">10</span>: iload_1<br><span class="hljs-number">11</span>: iinc          <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br><span class="hljs-number">14</span>: istore_1<br>···<br></code></pre></td></tr></table></figure>
<p>第10行：iload_1把局部变量表slot = 1的变量(i)加载到操作数栈上。</p>
<p>第11行：“iinc 1,1”对局部变量表slot = 1的变量(i)直接加1，但是这时候栈顶的元素没有变化，还是0.</p>
<p>第14行：istore_1 将栈顶元素出栈赋值给局部变量表slot = 1的变量，也就是i。此时，局部变量i又被赋值为0，前面的iinc指令对i的加一操作被覆盖。</p>
<p>整个过程局部变量表和操作数栈的变化如下图所示。</p>
<p><img src="/img/jvm/image-20210411010713498.png" srcset="/img/loading.gif" alt="i = i++ 字节码执行过程"></p>
<p>如果把上面代码的i = i++替换成 i  = ++i，则可以正常输出打印50。替换后的字节码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">···<br><span class="hljs-number">10</span>: iinc          <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br><span class="hljs-number">13</span>: iload_1<br><span class="hljs-number">14</span>: istore_1<br>···<br></code></pre></td></tr></table></figure>
<p>与上面i++的字节码不同的是，这里先对局部变量表中第1位变量进行了加一，然后将其加载到操作数栈，随后重新存储到局部变量表中。</p>
<h3 id="对象相关的字节码指令"><a href="#对象相关的字节码指令" class="headerlink" title="对象相关的字节码指令"></a>对象相关的字节码指令</h3><h4 id="1-lt-init-gt-方法"><a href="#1-lt-init-gt-方法" class="headerlink" title="1.&lt;init&gt;方法"></a>1.&lt;init&gt;方法</h4><p>&lt;init&gt;方法是对象初始化方法，类的构造方法、非静态变量的初始化、对象初始化代码块都会被编译进这个方法中。例如下面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Initializer</span> </span>&#123;<br>    <span class="hljs-comment">// 初始化变量</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;<br><br>    <span class="hljs-comment">// 构造器方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Initializer</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> c = <span class="hljs-number">30</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 对象初始化代码块</span><br>    &#123;<br>        <span class="hljs-keyword">int</span> b = <span class="hljs-number">20</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>对应字节码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Initializer</span><span class="hljs-params">()</span></span>;<br>  descriptor: ()V<br>  flags: (<span class="hljs-number">0x0001</span>) ACC_PUBLIC<br>  Code:<br>    stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">2</span>, args_size=<span class="hljs-number">1</span><br>       <span class="hljs-number">0</span>: aload_0<br>       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>       <span class="hljs-number">4</span>: aload_0<br>       <span class="hljs-number">5</span>: bipush        <span class="hljs-number">10</span><br>       7: putfield      #2                  // Field a:I<br>      <span class="hljs-number">10</span>: bipush        <span class="hljs-number">20</span><br>      <span class="hljs-number">12</span>: istore_1<br>      <span class="hljs-number">13</span>: bipush        <span class="hljs-number">30</span><br>      <span class="hljs-number">15</span>: istore_1<br>      <span class="hljs-number">16</span>: <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure>
<p>Initializer()方法对应&lt;init&gt;对象初始化方法，其中5<del>7行将成员变量a赋值为10，10</del>12行将b赋值为10，13~15行将c赋值为30。可以看到，虽然我们将变量a和变量b分别放在构造方法外和构造代码块中初始化，实际上也会统一编译到&lt;init&gt;方法里面。</p>
<h4 id="2-new、dup、invokespecial对象创建三条指令"><a href="#2-new、dup、invokespecial对象创建三条指令" class="headerlink" title="2.new、dup、invokespecial对象创建三条指令"></a>2.new、dup、invokespecial对象创建三条指令</h4><p>Java 中通过 new 关键字来创建对象，字节码中也有一个叫 new 的指令，但两者不是一回事。以下面的代码为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Initializer initializer = <span class="hljs-keyword">new</span> Initializer();<br></code></pre></td></tr></table></figure>
<p>编译后对应字节码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">0: new           #3                  // class Initializer<br><span class="hljs-number">3</span>: dup<br>4: invokespecial #4                  // Method &quot;&lt;init&gt;&quot;:()V<br><span class="hljs-number">7</span>: astore_1<br></code></pre></td></tr></table></figure>
<p>出去第 7 行的存储指令，new 关键字经过编译后实际上生成了 new-dup-invokespecial 3行字节码。new指令很容易理解，invokespecial 则是用于调用对象&lt;init&gt;方法来初始化对象，那么中间这个dup指令的作用是什么呢？</p>
<p>dup指令的含义是复制栈顶的数据并且插入到栈顶，在第0行时通过new指令创建了</p>
<p>Initializer的一个实例然后加入到栈顶，接着如果直接通过invokespecial调用其构造方法，由于invokespecial会消耗栈顶的类实例引用，会导致操作数栈为空，使得刚刚创建的对象丢失。因此在invokespecial调用前需使用dup复制一份实例，随后就可以通过astore_1指令将其存入局部变量表了。</p>
<h4 id="3-lt-clinit-gt-方法"><a href="#3-lt-clinit-gt-方法" class="headerlink" title="3.&lt;clinit&gt;方法"></a>3.&lt;clinit&gt;方法</h4><p>&lt;clinit&gt;是类的静态初始化方法，同样的，类静态初始化代码块、静态变量初始化都会被编译进这个方法中。javap输出字节码中的 static{} 表示&lt;cinit&gt;方法。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://book.douban.com/subject/35079283/">《深入理解JVM字节码》</a>
<a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://book.douban.com/subject/34907497">《深入理解Java虚拟机》</a>
<a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/JVM/">JVM</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Bytecode/">Bytecode</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/04/25/d39e151e/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">深入理解JVM（六）——字节码进阶</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/10/6e2382e5/">
                        <span class="hidden-mobile">深入理解JVM（四）——虚拟机执行子系统</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'sukaidev/sukaidev.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     Powered by  <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> , Theme  <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>





  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
